<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sohanur Construction & Manpower Solution</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --accent: #f59e0b;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { 
            margin: 0; 
            background: var(--bg); 
            color: var(--text);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Responsive Container */
        .container { 
            width: 100%;
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 15px; 
        }

        #loader {
            position: fixed; inset: 0; background: var(--white);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; background: #fff;
        }

        .spinner {
            width: 45px; height: 45px; border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Header Style */
        .app-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 0 0 25px 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .app-header h1 { margin: 0; font-size: 20px; letter-spacing: 1px; }

        /* Card System */
        .card-box { 
            background: var(--card); padding: 20px; border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .hide { display: none; }

        /* Profile & Summary */
        .summary-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        .sum-card { 
            padding: 15px; border-radius: 18px; color: white;
            background: linear-gradient(135deg, var(--primary), #3b82f6);
            text-align: center;
        }
        .sum-card h3 { margin: 5px 0 0; font-size: 22px; }

        .profile-strip { 
            display: flex; align-items: center; gap: 15px; 
            background: #f8fafc; padding: 15px; border-radius: 18px; 
        }
        .avatar { 
            width: 60px; height: 60px; border-radius: 50%; background: var(--accent);
            color: var(--primary); display: flex; align-items: center; justify-content: center;
            font-size: 26px; font-weight: 700; border: 3px solid white;
        }

        /* Input & Filter */
        .filter-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr auto; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        input[type="date"], input[type="text"] {
            padding: 10px; border-radius: 10px; border: 1px solid #cbd5e1; outline: none; width: 100%;
        }
        .btn-filter { 
            background: var(--accent); color: var(--primary); 
            border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer;
        }

        /* Table Responsive */
        .table-res { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 400px; }
        th { background: #f8fafc; color: var(--text); padding: 12px; font-size: 13px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }

        /* Footer Mobile Nav */
        footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; display: flex; justify-content: space-around;
            padding: 12px 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.08);
            z-index: 1000;
        }
        .nav-btn {
            background: none; border: none; color: #94a3b8;
            display: flex; flex-direction: column; align-items: center;
            font-size: 11px; cursor: pointer; flex: 1;
        }
        .nav-btn i { font-size: 22px; margin-bottom: 4px; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }

        /* Desktop Adjustment */
        @media (min-width: 768px) {
            .app-header { border-radius: 0; }
            body { padding-bottom: 0; }
            footer { 
                position: relative; box-shadow: none; border-top: 1px solid #e2e8f0; 
                border-radius: 0; padding: 20px; order: -1;
            }
        }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p style="margin-top: 15px; color: var(--primary); font-weight: 600;">Sohanur Construction & Manpower Solution</p>
</div>

<header class="app-header">
    <h1><i class="fas fa-book-reader"></i> কর্মী খাতা</h1>
</header>

<div class="container hide" id="loginBox">
    <div class="card-box" style="text-align: center;">
        <i class="fas fa-user-shield" style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"></i>
        <h3>Worker Login</h3>
        <input id="loginWorkerId" type="text" placeholder="Worker ID (Example: 101)">
        <button class="btn-filter" style="width: 100%; margin-top: 15px; height: 45px;" onclick="manualLogin()">লগইন করুন</button>
    </div>
</div>

<div class="container hide" id="dashboardPage">
    <div class="profile-strip card-box">
        <div class="avatar" id="avatar">W</div>
        <div class="info">
            <div style="font-size: 18px; font-weight: 700;" id="dName">---</div>
            <div style="font-size: 13px; color: #64748b;">ID: <span id="dId"></span> | <span id="dDes"></span></div>
            <div style="font-size: 13px; font-weight: 600;">Rate: <span id="dRate"></span> TK</div>
        </div>
    </div>

    <div class="summary-grid">
        <div class="sum-card">
            <small>Attended</small>
            <h3 id="sumAtt">0</h3>
        </div>
        <div class="sum-card" style="background: linear-gradient(135deg, #059669, #10b981);">
            <small>OT Hours</small>
            <h3 id="sumOT">0</h3>
        </div>
    </div>

    <div class="card-box">
        <div class="filter-row">
            <input type="date" id="startDateAtt">
            <input type="date" id="endDateAtt">
            <button class="btn-filter" onclick="filterAttendance()">Filter</button>
        </div>
        <div class="table-res">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Status</th>
                        <th>OT (Hr)</th>
                    </tr>
                </thead>
                <tbody id="outputAtt"></tbody>
            </table>
        </div>
    </div>
</div>

<div class="container hide" id="paymentPage">
    <div class="card-box sum-card" style="background: #1e2937;">
        <small>Total Payment Received</small>
        <h3 id="totalPayment">0 TK</h3>
    </div>

    <div class="card-box">
        <div class="filter-row">
            <input type="date" id="startDatePay">
            <input type="date" id="endDatePay">
            <button class="btn-filter" onclick="filterPayment()">Filter</button>
        </div>
        <div class="table-res">
            <table>
                <thead>
                    <tr>
                        <th>Payment Date</th>
                        <th style="text-align: right;">Amount</th>
                    </tr>
                </thead>
                <tbody id="outputPay"></tbody>
            </table>
        </div>
    </div>
</div>

<footer id="footerNav" class="hide">
    <button class="nav-btn active" id="nav-home" onclick="showPage('dashboardPage')">
        <i class="fas fa-th-large"></i>Home
    </button>
    <button class="nav-btn" id="nav-pay" onclick="showPage('paymentPage')">
        <i class="fas fa-wallet"></i>Payment
    </button>
    <button class="nav-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>Logout
    </button>
</footer>

<script>
    const workerCSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vScKUqfoXQNBZy7kPYd6bYpHV8_KsOMTDAA-Rx9PI03rZRUkoRHIz25htZDEuyhf8SerewYetdOgJai/pub?gid=544154648&single=true&output=csv";
    const attendanceCSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQeMfVC0OT9CSn4ShLoMNqfZ3pFD5RlkS2dCj1jdfjzvvvGYWOSUy5Mr-zdQ97lb96sjnoXZh5zFaCP/pub?gid=1560298674&single=true&output=csv";
    const paymentCSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vSTC_KsZ6QoVhc3gqToo1mV6fjmYwprGfieo2hVQ_4MUWViZNpslBZo3g7lua8g3cSxQbVMzaVJvgpl/pub?output=csv";

    let workers={}, attendance=[], payments=[], loggedId="";

    function csv(t){return t.split("\n").map(r=>r.split(","))}
    function fDate(d){
        if(!d) return "";
        let p=d.split("/");
        return p.length===3?`${p[2]}-${p[1].padStart(2,"0")}-${p[0].padStart(2,"0")}`:d;
    }

    Promise.all([
        fetch(workerCSV).then(r=>r.text()),
        fetch(attendanceCSV).then(r=>r.text()),
        fetch(paymentCSV).then(r=>r.text())
    ]).then(([w,a,p])=>{
        csv(w).slice(1).forEach(r=>{if(r[1]) workers[r[1].trim()]={name:r[2],des:r[3],rate:r[5]}})
        csv(a).slice(1).forEach(r=>{if(r[1]) attendance.push({id:r[1].trim(),date:fDate(r[5]),att:+r[6]||0,ot:+r[7]||0})})
        csv(p).slice(1).forEach(r=>{if(r[0]) payments.push({id:r[0].trim(),date:fDate(r[1]),amount:+r[2]||0})})
        
        loader.style.display="none";
        let id=new URLSearchParams(location.search).get("id");
        if(id && workers[id]) showDashboard(id); else loginBox.classList.remove("hide");
    });

    function manualLogin(){
        let id=loginWorkerId.value.trim();
        if(workers[id]) showDashboard(id); else alert("Wrong ID!");
    }

    function showDashboard(id){
        loggedId=id;
        loginBox.classList.add("hide");
        dashboardPage.classList.remove("hide");
        footerNav.classList.remove("hide");
        dId.innerText=id; dName.innerText=workers[id].name;
        dDes.innerText=workers[id].des; dRate.innerText=workers[id].rate;
        avatar.innerText=workers[id].name.charAt(0).toUpperCase();
        filterAttendance();
    }

    function showPage(p){
        dashboardPage.classList.add("hide"); paymentPage.classList.add("hide");
        document.getElementById(p).classList.remove("hide");
        document.getElementById('nav-home').classList.toggle('active', p==='dashboardPage');
        document.getElementById('nav-pay').classList.toggle('active', p==='paymentPage');
        if(p==='paymentPage') filterPayment();
    }

    function filterAttendance(){
        let s=startDateAtt.value, e=endDateAtt.value, h="", ta=0, to=0;
        attendance.filter(r=>r.id===loggedId).forEach(r=>{
            if((s && r.date<s) || (e && r.date>e)) return;
            ta+=r.att; to+=r.ot;
            h+=`<tr><td>${r.date}</td><td>${r.att} Day</td><td>${r.ot} Hr</td></tr>`;
        });
        outputAtt.innerHTML=h; sumAtt.innerText=ta; sumOT.innerText=to;
    }

    function filterPayment(){
        let s=startDatePay.value, e=endDatePay.value, h="", t=0;
        payments.filter(r=>r.id===loggedId).forEach(r=>{
            if((s && r.date<s) || (e && r.date>e)) return;
            t+=r.amount;
            h+=`<tr><td>${r.date}</td><td style="text-align:right; font-weight:bold;">${r.amount} TK</td></tr>`;
        });
        outputPay.innerHTML=h; totalPayment.innerText=t + " TK";
    }

    function logout(){ location.href=location.pathname; }
</script>
</body>
</html>
